package linuxhost_client

import (
	"testing"
)

var example_output string = `-----BEGIN CERTIFICATE-----
MIIDajCCAlKgAwIBAgITL34d0BkiQpSgGZOj8JQuQI/8sTANBgkqhkiG9w0BAQsF
ADBFMQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwY
SW50ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMB4XDTI0MTIxNzEwMDAwM1oXDTI1MDEx
NjEwMDAwM1owRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAf
BgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDCCASIwDQYJKoZIhvcNAQEB
BQADggEPADCCAQoCggEBAMOVsSkp9zGrU3BvgcvyZTz0TtIIpfz8XGsRyFuqySFD
VB4FGgpTp9Nmmgi2/thfevm4Bo3TrjjNH+q15kb66xb6Arn9YADqgVHf10dGC7VZ
gKvjJYRDCs7TNnWvLHgK+6ux0Jusne7afgtWqiPY1JVocO9mik2N4IREvsH6eRUK
tdwp1VV8a9KZyJLwJJCScklnc+N6pw0x1u4HoqDXmXx7eSP+RyESf3MSRXjEDctX
6QJKa8j3V0GzE6HT+FICd3FY1EXbV60NgteEIoLl/Uu6On58/Ls7Xh1DhpTWO3xh
CppxWBRVbL5da8GcUetE/pymSK8fcXaVycr4KfwprdECAwEAAaNTMFEwHQYDVR0O
BBYEFDR2EvlGH9wwnmMjv5TO3Tlua5sHMB8GA1UdIwQYMBaAFDR2EvlGH9wwnmMj
v5TO3Tlua5sHMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAKpg
L4I/59nfhTeJwUD0dNT1yVCx0Hl5pG1WdA21cmD87gDI4QD7JoKowf6YbJmQkiOy
/TcRBOQ8sj1qFxsIBgrHCRPro/bFjVEj3AKmNLEAmSSjkQzA2WV2t7+8ef5+e3Bt
4MTVfD78RlUYsqn5FaXBYc4gwm87QT8Z1CAwx1M8fkTxsG2xiBMlVF7qRXagcA/m
WMkQFYB9c3l1X82UIvlRRs7+dNXiUoK8wlvlt6bILkCp7JLQ2lQ0CYNhLur9n/QO
bwODh7MJO8vwZ1k2v8wTe4j1jaqsf9p+VYAKgg6SgVMNgjM2rqDBYtv1YmCaoSZ/
7yTb8aIhAZA3b2WNvxc=
-----END CERTIFICATE-----      
-----BEGIN CERTIFICATE-----
MIIDazCCAlOgAwIBAgIUO6vqRjtcbx4aB0h5euu//Bw53sEwDQYJKoZIhvcNAQEL
BQAwRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoM
GEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDAeFw0yNDEyMTcxMDAwNTlaFw0yNTAx
MTYxMDAwNTlaMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEw
HwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQDOsth/9pC7bmisf9Y23q76U5jbVfVyGkn7wdmS3WC4
uzDiVUVYzq+1w5X/OKH0/H/sCbtu8vRe0Q7XLPtFkIIyofja/PTIf+Va7puB3OFG
OGrtJBmPWI502dxPi4OFLi8Wd/6eOr40N2iPNTRuU62cAQlrRnpHLQdUMLzHqkco
awaBsnv6F4GlXYHcj1x3hoI5VBdnbVHkZeGh+bsTXs1/59klT57GCTIUjaiWzHii
2FlWGFDC/jAx8+0K/tEG7ykUK95SayRSZ92sXBk6nSuL5hQQNUlOxBaRqPXrtZSz
sajTRZX5TX6z1JqES4fdZtK2IrjMGYh/K5fcg+qsUOtFAgMBAAGjUzBRMB0GA1Ud
DgQWBBScx9ugICv3a0Bf681B2Opkxma0yDAfBgNVHSMEGDAWgBScx9ugICv3a0Bf
681B2Opkxma0yDAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQCu
bRVi5FtrytxavLWgyi4Fnpia+hSFb6/oEZ/PEC0CtQVxDSosePMI+OOkCRXGGLzS
STQ2Y2iEYkJErRI9qQs9ba6OMiC2J+JVwza+F//cOzhjlILkqmh3S19xTNOsky95
3D65IkSyXUz4tixCtuwdFfDyMcFvZIdub2dvyVIwps4/0dfAarf7gp1tn8fnCIvX
IO2IHBkZy5/crRquBb2lHXcn0DX7yznfdari7qBoxOu+9iUpD9kxDuQ9ooODDy06
+sNrsGmI0hWUpzafPBhYDJu2/21blSHnnWvNZbraURYQWkLc3ZDc4jEnIwsW3Yzw
Dmu38rBSNp8om1bQrIgR
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIICnTCCAiSgAwIBAgIMCL2Fl2yZJ6SAaEc7MAoGCCqGSM49BAMDMIGRMQswCQYD
VQQGEwJVUzERMA8GA1UECBMISWxsaW5vaXMxEDAOBgNVBAcTB0NoaWNhZ28xITAf
BgNVBAoTGFRydXN0d2F2ZSBIb2xkaW5ncywgSW5jLjE6MDgGA1UEAxMxVHJ1c3R3
YXZlIEdsb2JhbCBFQ0MgUDM4NCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTAeFw0x
NzA4MjMxOTM2NDNaFw00MjA4MjMxOTM2NDNaMIGRMQswCQYDVQQGEwJVUzERMA8G
A1UECBMISWxsaW5vaXMxEDAOBgNVBAcTB0NoaWNhZ28xITAfBgNVBAoTGFRydXN0
d2F2ZSBIb2xkaW5ncywgSW5jLjE6MDgGA1UEAxMxVHJ1c3R3YXZlIEdsb2JhbCBF
Q0MgUDM4NCBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTB2MBAGByqGSM49AgEGBSuB
BAAiA2IABGvaDXU1CDFHBa5FmVXxERMuSvgQMSOjfoPTfygIOiYaOs+Xgh+AtycJ
j9GOMMQKmw6sWASr9zZ9lCOkmwqKi6vr/TklZvFe/oyujUF5nQlgziip04pt89ZF
1PKYhDhloKNDMEEwDwYDVR0TAQH/BAUwAwEB/zAPBgNVHQ8BAf8EBQMDBwYAMB0G
A1UdDgQWBBRVqYSJ0sEyvRjLbKYHTsjnnb6CkDAKBggqhkjOPQQDAwNnADBkAjA3
AZKXRRJ+oPM+rRk6ct30UJMDEr5E0k9BpIycnR+j9sKS50gU/k6bpZFXrsY3crsC
MGclCrEMXu6pY5Jv5ZAL/mYiykf9ijH3g/56vxC+GCsej/YpHpRZ744hN8tRmKVu
Sw==
-----END CERTIFICATE-----
`

func TestParseOpenSSLCertificates(t *testing.T) {
	parsedCertificates := parseX509Certificates(example_output)
	if len(parsedCertificates) != 3 {
		t.Errorf("There should be 3 certificates present, got %d", len(parsedCertificates))
	}
	expectedFingerprint := [32]byte{85, 144, 56, 89, 200, 192, 195, 235, 184, 117, 158, 206, 78, 37, 87, 34, 95, 245, 117, 139, 189, 56, 235, 212, 130, 118, 96, 30, 27, 213, 128, 151}
	actualFingerprint := Sha256Fingerprint(parsedCertificates[2])
	if expectedFingerprint != actualFingerprint {
		t.Errorf("Expected certificate[2] sha256 to be\n%d\ngot:\n%d", expectedFingerprint, actualFingerprint)
	}
}
